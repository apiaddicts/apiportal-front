"use strict";(self.webpackChunka_3_developershelp=self.webpackChunka_3_developershelp||[]).push([[547],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>m});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},c=function(e){var a=u(e.components);return n.createElement(s.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(t),m=r,k=p["".concat(s,".").concat(m)]||p[m]||d[m]||i;return t?n.createElement(k,o(o({ref:a},c),{},{components:t})):n.createElement(k,o({ref:a},c))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=p;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=t[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},7477:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var n=t(7462),r=(t(7294),t(3905));const i={},o="Autenticaci\xf3n OAuth 2.0",l={unversionedId:"a3innuva-n\xf3mina/como-empezar/OAuth",id:"a3innuva-n\xf3mina/como-empezar/OAuth",title:"Autenticaci\xf3n OAuth 2.0",description:"OAuth 2.0 es un protocolo que permite a tu aplicaci\xf3n acceder a los datos de la cuenta de un usuario sin acceder a su contrase\xf1a. Para poder realizar peticiones a la API necesitar\xe1s, aparte de la Subscription Key del portal a3developer, un token de acceso que generar\xe1 la WKA al autenticar el usuario.",source:"@site/docs/01-a3innuva-n\xf3mina/01-como-empezar/04-OAuth.md",sourceDirName:"01-a3innuva-n\xf3mina/01-como-empezar",slug:"/a3innuva-n\xf3mina/como-empezar/OAuth",permalink:"/docusaurus/docs/a3innuva-n\xf3mina/como-empezar/OAuth",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Wolters Kluwer Account",permalink:"/docusaurus/docs/a3innuva-n\xf3mina/como-empezar/wolters-kluwer-account"},next:{title:"Problemas m\xe1s frecuentes",permalink:"/docusaurus/docs/a3innuva-n\xf3mina/como-empezar/problemas-frecuentes"}},s={},u=[{value:"Endpoints",id:"endpoints",level:2},{value:"Flujo de autenticaci\xf3n",id:"flujo-de-autenticaci\xf3n",level:2},{value:"1. Redirige al usuario para autorizar tu aplicaci\xf3n",id:"1-redirige-al-usuario-para-autorizar-tu-aplicaci\xf3n",level:3},{value:"2. Llamada al punto de autorizaci\xf3n del WKA Auth Server",id:"2-llamada-al-punto-de-autorizaci\xf3n-del-wka-auth-server",level:3},{value:"3. WKA Auth Server muestra una pantalla de login",id:"3-wka-auth-server-muestra-una-pantalla-de-login",level:3},{value:"4. El usuario informa sus credenciales",id:"4-el-usuario-informa-sus-credenciales",level:3},{value:"5. Autorizaci\xf3n",id:"5-autorizaci\xf3n",level:3},{value:"6. Intercambiar el Authorization Code",id:"6-intercambiar-el-authorization-code",level:3},{value:"7.  El servidor WKA Auth devuelve el access_token",id:"7--el-servidor-wka-auth-devuelve-el-access_token",level:3},{value:"Contenido del access-token",id:"contenido-del-access-token",level:4},{value:"8. Llamada a la API",id:"8-llamada-a-la-api",level:3},{value:"9. Respuesta de la API",id:"9-respuesta-de-la-api",level:3},{value:"10. Refresco del access_token y refresh_token",id:"10-refresco-del-access_token-y-refresh_token",level:3},{value:"11.  El servidor WKA Auth devuelve el access_token refrescado",id:"11--el-servidor-wka-auth-devuelve-el-access_token-refrescado",level:3}],c={toc:u};function d(e){let{components:a,...i}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,i,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"autenticaci\xf3n-oauth-20"},"Autenticaci\xf3n OAuth 2.0"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://oauth.net/2/"},"OAuth 2.0"))," es un protocolo que permite a tu aplicaci\xf3n acceder a los datos de la cuenta de un usuario sin acceder a su contrase\xf1a. Para poder realizar peticiones a la API necesitar\xe1s, aparte de la ",(0,r.kt)("em",{parentName:"p"},"Subscription Key")," del portal a3developer, un token de acceso que generar\xe1 la WKA al autenticar el usuario."),(0,r.kt)("admonition",{title:"Atenci\xf3n",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Para poder obtener el token es necesario disponer de un ",(0,r.kt)("strong",{parentName:"p"},"client OAuth")," personalizado por cada cliente de ",(0,r.kt)("strong",{parentName:"p"},"a3innuva | n\xf3mina")," y es un proceso que actualmente gestionamos internamente desde Wolters Kluwer. Si no dispones de un client OAuth, por favor, completa el siguiente ",(0,r.kt)("a",{parentName:"p",href:"https://forms.office.com/r/8h9FA4K5Lr"},"formulario")," para que podamos proporcion\xe1rtelo.")),(0,r.kt)("p",null,"Implementamos un flujo de autenticaci\xf3n ",(0,r.kt)("i",null,"H\xedbrido-Authorization Code"),", que es el que se utiliza habitualmente para aplicaciones web. Es importante que tu aplicaci\xf3n web mantenga seguros los credenciales de autenticaci\xf3n (",(0,r.kt)("inlineCode",{parentName:"p"},"client_id")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret"),")"),(0,r.kt)("h2",{id:"endpoints"},"Endpoints"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"Endpoint"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Autorizaci\xf3n"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://login.wolterskluwer.eu/auth/core/connect/authorize"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Request token"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://login.wolterskluwer.eu/auth/core/connect/token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Refresh token"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://login.wolterskluwer.eu/auth/core/connect/token"))))),(0,r.kt)("admonition",{title:"Atenci\xf3n",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"La comunicaci\xf3n con el sistema de WKA deber\xe1 ser mediante TLS 1.2 o superior.")),(0,r.kt)("h2",{id:"flujo-de-autenticaci\xf3n"},"Flujo de autenticaci\xf3n"),(0,r.kt)("mermaid",{value:"sequenceDiagram\n    autonumber\n    User --\x3e> Your Web App: Click login link\n    Your Web App --\x3e> WKA Auth Server: Authorization Code Request to /authorize\n    WKA Auth Server --\x3e> User: Show login form\n    User --\x3e> WKA Auth Server: Authenticate and Consent\n    WKA Auth Server --\x3e> Your Web App: Authorization Code\n    Your Web App --\x3e>+ WKA Auth Server: Authorization Code + Client_Id + Client_Secret to /token\n    Note right of WKA Auth Server: Validate Authorization Code + Client_Id + Client_Secret\n    WKA Auth Server --\x3e>- Your Web App: Id_token + Access_token + Refresh_token\n    Your Web App --\x3e> API a3innuva | laboral: Request user data with Acces_token\n    API a3innuva | laboral--\x3e> Your Web App: Response\n    Your Web App --\x3e>+ WKA Auth Server: Refresh token\n    Note right of WKA Auth Server: Validate Refresh_token + Client_Id + Client_Secret    \n    WKA Auth Server --\x3e>- Your Web App: Id_token + Access_token + Refresh_token    "}),(0,r.kt)("h3",{id:"1-redirige-al-usuario-para-autorizar-tu-aplicaci\xf3n"},"1. Redirige al usuario para autorizar tu aplicaci\xf3n"),(0,r.kt)("p",null,"Tu aplicaci\xf3n debe dirigir a los usuarios a la siguiente URL: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"https://login.wolterskluwer.eu/auth/core/connect/authorize?\nclient_id=YOUR_CLIENT_ID&\nresponse_type=code+id_token&\nresponse_mode=fragment&\nredirect_uri=YOUR_REDIRECT_URI&\nscope=offline_access+openid+IDInfo+WK.ES.A3EquipoContex&\nstate=GUID&\nnonce=GUID\n")),(0,r.kt)("p",null,"Los siguientes valores se deben de pasar como par\xe1metro:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": es el client_id del client OAuth que te hemos proporcionado. Por ejemplo: ",(0,r.kt)("inlineCode",{parentName:"li"},"\nWK.ES.A3WebApi.A23456")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"response_type"),": ",(0,r.kt)("strong",{parentName:"li"},"code+id_token")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"response_mode"),": ",(0,r.kt)("strong",{parentName:"li"},"fragment")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"redirect_uri"),": la URL en tu servidor para redirigir de vuelta: esta debe ser una direcci\xf3n ",(0,r.kt)("inlineCode",{parentName:"li"},"https"),", sin embargo, para probar puedes usar ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:53971/Login/CallbackFromWKA")," o ",(0,r.kt)("inlineCode",{parentName:"li"},"http://oob/oauth20_desktop.srf")," si es una aplicaci\xf3n de escritorio. Ten en cuenta que no se puede usar ",(0,r.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1")," Si necesitas agregar una nueva ",(0,r.kt)("inlineCode",{parentName:"li"},"redirect_uri")," recuerda que debes hacer la petici\xf3n a trav\xe9s de este ",(0,r.kt)("a",{parentName:"li",href:"https://forms.office.com/r/8h9FA4K5Lr"},"formulario"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scope"),": ",(0,r.kt)("strong",{parentName:"li"},"offline_access+openid+IDInfo+WK.ES.A3EquipoContex")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"state"),": es un texto que debe usarse para evitar ataques de falsificaci\xf3n. Informa un valor \xfanico para cada llamada (por ejemplo, un ",(0,r.kt)("inlineCode",{parentName:"li"},"GUID"),") que se devolver\xe1 como par\xe1metro en la llamada a tu ",(0,r.kt)("inlineCode",{parentName:"li"},"redirect_uri"),". Deber\xe1s validar que el valor enviado coincide con el recibido."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"nonce"),": el objetivo de este par\xe1metro es parecido al del ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," salvo que este valor se incluir\xe1 dentro del ",(0,r.kt)("inlineCode",{parentName:"li"},"id_token"))),(0,r.kt)("h3",{id:"2-llamada-al-punto-de-autorizaci\xf3n-del-wka-auth-server"},"2. Llamada al punto de autorizaci\xf3n del WKA Auth Server"),(0,r.kt)("p",null,"Tu sitio web deber\xe1 lanzar una petici\xf3n GET con la url construida seg\xfan el punto anterior. "),(0,r.kt)("h3",{id:"3-wka-auth-server-muestra-una-pantalla-de-login"},"3. WKA Auth Server muestra una pantalla de login"),(0,r.kt)("p",null,"Si la url est\xe1 bien construida y la petici\xf3n es correcta, nuestro servidor de autenticaci\xf3n mostrar\xe1 una pantalla de login para que el usuario informe sus credenciales de la WKA.\n",(0,r.kt)("img",{alt:"LoginWKA",src:t(643).Z,width:"919",height:"811"})),(0,r.kt)("admonition",{title:"Importante!",type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Recuerda que los credenciales de la WKA no tienen porqu\xe9 ser los mismos que los del portal a3developer. Son las credenciales con las que normalmente accede el usuario a su aplicaci\xf3n ",(0,r.kt)("b",null,"a3innuva | n\xf3mina"))),(0,r.kt)("h3",{id:"4-el-usuario-informa-sus-credenciales"},"4. El usuario informa sus credenciales"),(0,r.kt)("p",null,"Si el usuario de WKA tiene acceso a varias empresas (tenants), se le mostrar\xe1 un formulario donde deber\xe1 seleccionar qu\xe9 conjunto de recursos quiere exponer:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"LoginWKAIDCA",src:t(3770).Z,width:"979",height:"586"})),(0,r.kt)("h3",{id:"5-autorizaci\xf3n"},"5. Autorizaci\xf3n"),(0,r.kt)("p",null,"El servidor de autorizaci\xf3n de WKA validar\xe1 los credenciales informados, y si son correctos, enviar\xe1 una petici\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"GET")," a la ",(0,r.kt)("inlineCode",{parentName:"p"},"return_uri")," con los par\xe1metros:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code"),": un c\xf3digo temporal que solo se puede canjear una vez y caduca 5 minutos despu\xe9s de su emisi\xf3n. Revisa el siguiente punto donde se detalla c\xf3mo usarlo."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"id_token"),": es un ",(0,r.kt)("a",{parentName:"li",href:"https://es.wikipedia.org/wiki/JSON_Web_Token"},"JWT Token")," que contiene informaci\xf3n de identificaci\xf3n. ",(0,r.kt)("strong",{parentName:"li"},"No es el token de acceso a la aplicaci\xf3n"),". Est\xe1 cifrado con ",(0,r.kt)("a",{parentName:"li",href:"https://es.wikipedia.org/wiki/SHA-2"},"SHA-256")," y en el ",(0,r.kt)("i",null,"payload")," puedes revisar informaci\xf3n acerca de la identidad y de seguridad (por ejemplo, el valor ",(0,r.kt)("inlineCode",{parentName:"li"},"nonce")," para contrastarlo con el que has enviado)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"state"),": si el ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," no coincide con el enviado, la solicitud puede haber sido creada por un tercero y debes cancelar el proceso.")),(0,r.kt)("h3",{id:"6-intercambiar-el-authorization-code"},"6. Intercambiar el Authorization Code"),(0,r.kt)("p",null,"Ahora ya puedes obtener el ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," utilizando el ",(0,r.kt)("inlineCode",{parentName:"p"},"code")," que te ha proporcionado el WKA Auth Server. Para realizar este paso, deber\xe1s enviar una petici\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"POST")," al endpoint:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"https://login.wolterskluwer.eu/auth/core/connect/token\n")),(0,r.kt)("p",null,"Esta petici\xf3n requiere de unos par\xe1metros en el ",(0,r.kt)("inlineCode",{parentName:"p"},"header"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": es el identificador de tu cliente OAuth. Por ejemplo ",(0,r.kt)("inlineCode",{parentName:"li"},"WK.ES.A3WebApi.A23456")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_secret"),": es la clave secreta de tu cliente OAuth. Por ejemplo ",(0,r.kt)("inlineCode",{parentName:"li"},"NvPqSESxR9JKr6Te")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code"),": el ",(0,r.kt)("inlineCode",{parentName:"li"},"code")," que has obtenido en el paso anterior."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"grant_type"),": ",(0,r.kt)("strong",{parentName:"li"},"authorization_code")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"redirect_uri"),": la misma uri que has informado en el proceso de autorizaci\xf3n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request POST 'https://login.wolterskluwer.eu/auth/core/connect/token' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'client_id=YOUR_CLIENT_ID' \\\n--data-urlencode 'client_secret=YOUR_CLIENT_SECRET'\n--data-urlencode 'code=YOUR_AUTHORIZATION_CODE' \\\n--data-urlencode 'grant_type=authorization_code' \\\n--data-urlencode 'redirect_uri=YOUR_REDIRECT_URI' \\\n")),(0,r.kt)("h3",{id:"7--el-servidor-wka-auth-devuelve-el-access_token"},"7.  El servidor WKA Auth devuelve el access_token"),(0,r.kt)("p",null,"El servidor WKA Auth verificar\xe1 todos los par\xe1metros en la solicitud, asegur\xe1ndose de que el c\xf3digo no haya caducado y que la identificaci\xf3n del cliente y el secreto coincidan. Si todo sale bien, generar\xe1 tus tokens y los devolver\xe1 en la respuesta, que contendr\xe1 los siguientes valores:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"access_token"),": JWT token necesario para poder hacer las llamadas a la ",(0,r.kt)("strong",{parentName:"li"},"API a3innuva | laboral")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"id_token"),": JWT token con datos de la identidad del usuario."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"expires_in"),": tiempo en segundos hasta que el token expire. Por defecto son 60 minutos."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"token_type"),": ",(0,r.kt)("strong",{parentName:"li"},"Bearer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"refresh_token"),": Es el token que se puede utilizar para refrescar el ",(0,r.kt)("inlineCode",{parentName:"li"},"access_token")," una vez haya expirado. Por defecto tiene una caducidad de 30 d\xedas.")),(0,r.kt)("h4",{id:"contenido-del-access-token"},"Contenido del access-token"),(0,r.kt)("p",null,"El ",(0,r.kt)("inlineCode",{parentName:"p"},"access-token")," es un JSON web token (JWT) que se puede decodificar en un objeto JSON y contiene informaci\xf3n sobre el usuario y la autenticaci\xf3n realizada."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "$id": "1",\n  "iss": "https://login.wolterskluwercloud.com",\n  "aud": "https://login.wolterskluwercloud.com/resources",\n  "exp": 1668712060,\n  "nbf": 1668708460,\n  "client_id": "WK.ES.A3WebApi.A23456",\n  "scope": [\n    "offline_access",\n    "openid",\n    "IDInfo",\n    "WK.ES.A3EquipoContex"\n  ],\n  "sub": "d6d396d5-4bfe-4fcd-9f2a-ab76007854a5",\n  "auth_time": 1668707536,\n  "idp": "idsrv",\n  "wk.es.clientid": "23456",\n  "wk.es.idcda": "1M8Q2",\n  "wk.es.a3equipouserid": "a3developers@wolterskluwer.com",\n  "wk.es.secondclientid": "65432",\n  "usr": "9cff49af-1b13-4964-9291-ad8d0cb047a9",\n  "owapp": "53335e0c-a116-44f5-b525-aa4400ada916",\n  "mem": "9cff49cf-1b23-4334-2191-aa8800b04779",\n  "oun": "82bffb8f-4b0b-4065-ac27-aba600f09952",\n  "amr": [\n    "password"\n  ]\n}\n')),(0,r.kt)("p",null,"El campo ",(0,r.kt)("inlineCode",{parentName:"p"},"exp")," hace referencia a la fecha de expiraci\xf3n del ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," en formato ",(0,r.kt)("a",{parentName:"p",href:"https://www.rfc-editor.org/rfc/rfc3339"},"EPOCH")),(0,r.kt)("p",null,"Necesitar\xe1s validar que el JWT est\xe1 correctamente firmado y verificar que la informaci\xf3n que contiene es correcta. En ",(0,r.kt)("a",{parentName:"p",href:"https://jwt.io/libraries"},"esta p\xe1gina")," puedes ver un conjunto de librer\xedas por lenguaje de programaci\xf3n, indicando para cada una qu\xe9 claims se verifican."),(0,r.kt)("admonition",{title:"Atenci\xf3n",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"El tiempo de expiraci\xf3n del access_token es de 1 hora. ")),(0,r.kt)("h3",{id:"8-llamada-a-la-api"},"8. Llamada a la API"),(0,r.kt)("p",null,"Ahora ya puedes hacer llamadas a la ",(0,r.kt)("strong",{parentName:"p"},"API a3innuva | laboral")," a\xf1adiendo al ",(0,r.kt)("inlineCode",{parentName:"p"},"header"),"de tu petici\xf3n las siguientes variables:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Authorization"),': "Bearer " + access_token'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Ocp-Apim-Subscription-Key"),": clave principal de tu suscripci\xf3n del portal a3developer.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"GET /Laboral/api/companies?pageNumber=1&pageSize=25&filter=lastUpdate gt 2022-01-01&OrderBy=companyCode\nAuthorization: Bearer eyIkaWQiOiIxIiwidHlwIjoiSld...\nOcp-Apim-Subscription-Key: 2kxwf5rb7ffb65dd5\nContent-Type: application/json\n")),(0,r.kt)("h3",{id:"9-respuesta-de-la-api"},"9. Respuesta de la API"),(0,r.kt)("p",null,"Si la ",(0,r.kt)("inlineCode",{parentName:"p"},"Ocp-Apim-Subscription-Key")," y el ",(0,r.kt)("inlineCode",{parentName:"p"},"acces_token")," son v\xe1lidos, la API devolver\xe1 la informaci\xf3n en formato json:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n    "companyCode": 100,\n    "companyName": "EMPRESA TEST",\n    "identifierNumber": "E2133833T",\n    "lastUpdate": "2022-06-30T11:22:59.563Z"\n    }\n]\n')),(0,r.kt)("h3",{id:"10-refresco-del-access_token-y-refresh_token"},"10. Refresco del access_token y refresh_token"),(0,r.kt)("p",null,"Los tokens de acceso caducan despu\xe9s de 60 minutos. Tu aplicaci\xf3n puede actualizar un token de acceso sin la interacci\xf3n del usuario mediante un ",(0,r.kt)("inlineCode",{parentName:"p"},"refresh_token"),", que se obtiene en el paso 7 y tiene una caducidad de 30 d\xedas. Durante estos 30 d\xedas podr\xe1s generar nuevos ",(0,r.kt)("inlineCode",{parentName:"p"},"access-token"),"  sin necesidad de que el usuario ingrese de nuevo sus credenciales. "),(0,r.kt)("p",null,"Para refrescar el ",(0,r.kt)("inlineCode",{parentName:"p"},"access-token")," deber\xe1s enviar una petici\xf3n POST al ",(0,r.kt)("inlineCode",{parentName:"p"},"token endpoint"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"https://login.wolterskluwer.eu/auth/core/connect/token\n")),(0,r.kt)("p",null,"Esta petici\xf3n requiere de unos par\xe1metros en el ",(0,r.kt)("inlineCode",{parentName:"p"},"header"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": es el identificador de tu cliente OAuth. Por ejemplo ",(0,r.kt)("inlineCode",{parentName:"li"},"\nWK.ES.A3WebApi.A23456")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_secret"),": es la clave secreta de tu cliente OAuth. Por ejemplo ",(0,r.kt)("inlineCode",{parentName:"li"},"NvPqSESxR9JKr6Te")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"grant_type"),": ",(0,r.kt)("strong",{parentName:"li"},"refresh_token")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"refresh_token"),": el ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh-token")," que has obtenido en el punto 7.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl --location --request POST 'https://login.wolterskluwer.eu/auth/core/connect/token' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'client_id=YOUR_CLIENT_ID' \\\n--data-urlencode 'client_secret=YOUR_CLIENT_SECRET'\n--data-urlencode 'grant_type=refresh_token' \\\n--data-urlencode 'refresh_token=YOUR_REFRESH_TOKEN' \\\n")),(0,r.kt)("h3",{id:"11--el-servidor-wka-auth-devuelve-el-access_token-refrescado"},"11.  El servidor WKA Auth devuelve el access_token refrescado"),(0,r.kt)("p",null,"Si la validaci\xf3n del ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," es correcta, el servidor WKA Auth generar\xe1 tus tokens y los devolver\xe1 en la respuesta, que contendr\xe1 los siguientes valores:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"access_token"),": nuevo JWT token necesario para poder hacer las llamadas a la ",(0,r.kt)("strong",{parentName:"li"},"API a3innuva | laboral")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"id_token"),": JWT token con datos de la identidad del usuario."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"expires_in"),": tiempo en segundos hasta que el token expire. Por defecto son 60 minutos."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"token_type"),": ",(0,r.kt)("strong",{parentName:"li"},"Bearer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"refresh_token"),": Nuevo ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token"),". Dependiendo de la configuraci\xf3n del client OAuth, es posible que sea diferente al ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token")," previo. Deber\xe1s guardar en lugar seguro este token para poder utilizarlo m\xe1s adelante.")))}d.isMDXComponent=!0},3770:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/Login_IDCDA-3c60c8bc64c962f52cf446ba8c0cd5e2.PNG"},643:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/Login_WKA-d776bdb7218eaf125d5e4e7c35d40d78.PNG"}}]);